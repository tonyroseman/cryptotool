{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}
<!-- [ Main Content ] start -->
<!-- [ breadcrumb ] start -->
<div class="page-header">
    <div class="row align-items-center">
        <div class="col-md-12">
            <div class="page-header-title">
                <h5 class="m-b-10">Top {{user.limitcount}} coins</h5>
            </div>
            
        </div>
    </div>
    
</div>
<!-- [ breadcrumb ] end -->
<div class="row">
    

    <div class="col-xs-12">
        <table id="myDataTable" class="display responsive nowrap" style="width:100%">
            <thead>
                <tr>
                    <th rowspan="2" >No.</th>
                    <th rowspan="2" >Symbol</th>
                    <th rowspan="2" >Current<br> Price<br>(USD)</th>
                    
                    <th rowspan="2" >Market <br>cap<br>(mil $)</th>
                    <th rowspan="2" >Volume <br>24H<br>(mil $)</th>
                    <th rowspan="2" >Volume <br>change<br>24H (%)</th>
                    <th rowspan="2" >Volume/<br>Market<br> cap</th>
                    <th rowspan="2" >Funding <br>rate <br>(%)</th>
                    <th rowspan="2" >Long <br>Short<br>Ratio</th>
                    <th colspan="11" style="border-left: 1px solid rgba(0, 0, 0, 0.3)">% Change</th>
                    <th colspan="2" style="border-left: 1px solid rgba(0, 0, 0, 0.3)">Candle 1H 
                        &nbsp;&nbsp;
                        <a href="#" style="font-size: 20px;" data-toggle="tooltip" data-placement="top-end" data-bs-html="true" title="This column gives us information about how many 1-hour candles have had strong fluctuations in the past 2 or 7 days. The higher it is, the higher it shows that this crypto currency is receiving attention and trading strongly and vice versa<br><br>
                        Cột này cho chúng ta thông tin có bao nhiêu nến 1 giờ có giao động mạnh trong vòng 2 hoặc 7 ngày vừa qua. Càng cao chứng tỏ crypto này đang được chú ý, giao dịch mạnh và ngược lại">
                        <span class="pcoded-micon"><i class="feather icon-help-circle"></i></span></a></th>
                    <th colspan="2" style="border-left: 1px solid rgba(0, 0, 0, 0.3)">RSI
                        &nbsp;&nbsp;
                        
                        <a href="#" style="font-size: 20px;" data-toggle="tooltip" data-placement="top-end" data-bs-html="true" title="Relative Strength Index<br><hr class='line'>
                        When it comes to using RSI to trade, a common method for this technical indicator you'll often see in forums is to buy when RSI goes into oversold territory (below 30) and sell when it goes into overbought territory (above 70).<br><br>
                        
                        Khi nói đến việc sử dụng RSI (Chỉ số sức mạnh tương đối) để giao dịch, một phương pháp phổ biến cho chỉ báo kỹ thuật này bạn thường thấy trên các diễn đàn là mua khi RSI đi vào vùng quá bán (dưới 30) và bán khi nó đi vào vùng quá mua ( trên 70).">
                        <span class="pcoded-micon"><i class="feather icon-help-circle"></i></span></a></th>
                    <th colspan="2" style="border-left: 1px solid rgba(0, 0, 0, 0.3)">
                        
                       
                        
                        Bollinger<br>band
                        &nbsp;&nbsp;
                        <a href="#" style="font-size: 20px;" data-toggle="tooltip" data-placement="top-end" data-bs-html="true" title="<div class='tooltip-content'>
                            <div class='column'>
                                Bollinger Bands<br>
                                <hr class='line'> 
                                It involves the use of three bands—one for the upper level, another for the lower level, and the third for the moving average. When prices move closer to the upper band, it indicates that the market may be overbought. Conversely, the market may be oversold when prices end up moving closer to the lower or bottom band.<br><br>
                                
                                Nó liên quan đến việc sử dụng ba dải—một cho mức trên, một cho mức dưới và dải thứ ba cho đường trung bình động. Khi giá tiến gần đến dải trên, điều đó cho thấy thị trường có thể đang ở trạng thái quá mua. Ngược lại, thị trường có thể bị bán quá mức khi giá tiến gần đến dải dưới </div>
                            <div class='column'><br>
                                <hr class='line'> 
                                
                                0: bottom band<br> 
                                1: upper band<br>
                                0.5: moving average<br><br>
                                if the number is close to the upper band or crosses it -> overbought -> should sell<br>
                                if the number is close to the lower band or crosses it -> oversold -> should buy<br><br>
                                
                                0: dải dưới <br>
                                1: dải trên<br>
                                0.5: đường trung bình động<br><br>
                                nếu con số gần đến dải trên hoặc vượt qua nó -> quá mua -> nên bán<br>
                                nếu con số gần đến dải dưới hoặc vượt qua nó -> quá bán -> nên mua
                            </div>
                        </div>">
                        <span class="pcoded-micon"><i class="feather icon-help-circle"></i></span></a></th>
                    <th colspan="1" style="border-left: 1px solid rgba(0, 0, 0, 0.3)">Fibonacci<br>Retracement
                        &nbsp;&nbsp;
                        <a href="#" style="font-size: 20px;" data-toggle="tooltip" data-placement="top-end" data-bs-html="true" title="Fibonacci Retracements<br>
                            <hr class='line'> 
                        The up-arrow means that the most recent market in 7 days is currently in an uptrend. Down-arrow means downtrend. The negative symbol also means that the market is in the most recent downtrend.<br>
                        
                        During an uptrend, the price often tends to return to the 0.382 -> 0.5 and 0.5 -> 0.618 areas and then continue to follow the trend. Therefore, many traders often place “buy” orders at these price ranges (Similar to downtrend).<br>
                        ***The data analysis algorithm is updated every 10 hours, so if any cryptocurrency fluctuates strongly in a short period of time, the results may be inaccurate (after 10 hours it will be automatically recalculated).<br><br>
                        
                        Mũi tên lên có nghĩa thị thường gần nhất trong 7 ngày đang là up trend. mũi tên xuống có nghĩa là đang downtrend. kí hiệu âm cũng mang cũng mang ý nghĩa thị trường đang downtrend gần đây nhất<br>
                        Trong một uptrend, giá thường có xu hướng quay trở về vùng 0.382 -> 0.5 và 0.5 -> 0.618 rồi tiếp tục đi theo xu hướng. Cho nên nhiều nhà giao dịch thường đặt lệnh mua ở những vùng giá này (Tương tự với downtrend )<br>
                        ***Thuật toán phân tích dự liệu cập nhật mỗi 10h cho nên nếu có crypto nào giao động mạnh trong khoảng thời gian ngắn, kết quả có thể bị sai lệch ( sau 10h sẽ được tự động tính chính xác lại )<br>">
                        <span class="pcoded-micon"><i class="feather icon-help-circle"></i></span></a></th>

                    
                    
                    
                    
                    
                    <!-- Add more table headers as needed -->
                </tr>
                <tr>
                    
                    <th style="border-left: 1px solid rgba(0, 0, 0, 0.3)">1'</th>                    
                    <th >3'</th>                    
                    <th >5'</th>
                    <th >15'</th>
                    <th >1H</th>
                    <th >6H</th>
                    <th >12H</th>
                    <th >1D</th>
                    <th >2D</th>
                    <th >4D</th>
                    <th >7D</th>
                    <th style="border-left: 1px solid rgba(0, 0, 0, 0.3)">2D</th>
                    <th >7D</th>
                    <th style="border-left: 1px solid rgba(0, 0, 0, 0.3)">1H</th>
                    <th >4H</th>
                    <th style="border-left: 1px solid rgba(0, 0, 0, 0.3)">1H</th>
                    <th >4H</th>
                    <th style="border-left: 1px solid rgba(0, 0, 0, 0.3)">7D</th>
                    
                    
                    <!-- Add more table headers as needed -->
                </tr>
            </thead>
            <!-- <tfoot>
                <tr>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Office</th>
                    <th>Extn.</th>
                    <th>Start date</th>
                    <th>Salary</th>
                </tr>
            </tfoot> -->
        </table>
</div>
    
</div>

<!-- [ Main Content ] end -->

<script>
    
    function compare(a,b){
        if(Math.round(parseFloat(a)*10000)/10000 > Math.round(parseFloat(b)*10000)/10000){
            return 1;
        }
        else if(Math.round(parseFloat(a)*10000)/10000 < Math.round(parseFloat(b)*10000)/10000){
            return -1;
        }
        else{
            return 0;
        }
    }
    $(document).ready(function() {
        
        $.fn.dataTable.ext.errMode = 'none';
        const dataMap = new Map();
        function numberRender(data, type, row) {
            if(data != undefined){
                return '' +  Math.round(data * 10000) / 10000;
                
            }
        }
        function fibnumberRender(data, type, row) {
            if(data != undefined){
                if (data >= 0){
                    return '<font color="green">▲ </font>' +  Math.round(data * 100) / 100;
                }
                else{
                    return '<font color="red">▼ </font>' +  Math.round(data * 100) / 100;
                }
                
                
            }
        }
        function numberRender1(data, type, row) {
            if(data != undefined){
                return '' +  Math.round(data * 10) / 10;
                
            }
        }
        function numberRender2(data, type, row) {
            if(data != undefined){
                return '' +  Math.round(data * 100) / 100;
                
            }
        }
        function FundingRateRender(data, type, row) {
            if(data != undefined){
                if(row.c1000 == 0)
                    return "<a href='https://www.binance.com/en/futures/" + row.symbol + "USDT' target='_blank'>" + Math.round(data * 10000) / 10000 + "</a>";
                else
                    return "<a href='https://www.binance.com/en/futures/1000" + row.symbol + "USDT' target='_blank'>" + Math.round(data * 10000) / 10000 + "</a>";
                
            }
        }
        function linkRender(data, type, row) {
            if(data != undefined){
                
                    return "<a href='https://www.binance.com/en/trade/" + data + "_USDT?theme=dark&type=spot' target='_blank'>" + data + "</a>";
                
 
                
            }
        }
        
        coindataTable = new DataTable('#myDataTable', {
            ajax: '{% url "get_coindata_all"%}',
            columns: [
            { data: 'no'},
                    { data: 'symbol' ,
                        render: linkRender}, //or { data: 'MONTH', title: 'Month' }`
                    { data: 'price' ,
                        render: numberRender},
                    
                    { data: 'market_cap' ,
                        render: numberRender1},
                    { data: 'vol_24h' ,
                        render: numberRender1},
                    { data: 'vol' ,
                        render: numberRender1},
                    { data: 'vm' ,
                        render: numberRender},
                    { data: 'fr' ,
                        render: FundingRateRender},   
                    { data: 'ls' ,
                        render: numberRender},    
                    { data: '1m' ,
                        render: numberRender},
                    { data: '3m' ,
                        render: numberRender},
                    { data: '5m' ,
                        render: numberRender},
                    { data: '15m' ,
                        render: numberRender},
                    { data: '1h' ,
                        render: numberRender},
                    { data: '6h' ,
                        render: numberRender},
                    { data: '12h' ,
                        render: numberRender},
                    { data: '1d' ,
                        render: numberRender},
                    { data: '2d' ,
                        render: numberRender},
                    { data: '4d' ,
                        render: numberRender},
                    { data: '7d' ,
                        render: numberRender},
                    { data: 'c2' ,
                        render: numberRender},
                    { data: 'c7' ,
                        render: numberRender},
                    { data: 'r1h' ,
                        render: numberRender1},
                    { data: 'r4h' ,
                        render: numberRender1},
                    { data: 'b1h' ,
                        render: numberRender2},
                    { data: 'b4h' ,
                        render: numberRender2},
                    { data: 'f7d' ,
                        render: fibnumberRender},


                    
            ]
        });
        $('#myDataTable').on( 'error.dt', function ( e, settings, techNote, message ) {
            console.log( 'An error has been reported by DataTables: ', message );
            
            

        } ) ;    
        

        setInterval( function () {
            coindataTable.ajax.reload( null, false);
        }, 1000 );
    });
 
</script>

{% endblock content %}
